<app-breadcrumb></app-breadcrumb>

<div *ngIf="photos.length > 0; else noPhotos" class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <div class="text-center mb-12">
    <h1 class="text-4xl sm:text-5xl lg:text-7xl font-extrabold text-gray-900 dark:text-white mb-2">Photos du jour ðŸ“¸</h1>
  </div>
  
  <div *ngIf="!allLoaded" class="flex flex-col items-center justify-center min-h-[400px]">
    <ng-lottie [options]="loaderOptions" class="w-24 h-24"></ng-lottie>
    <span class="text-lg font-medium text-gray-500 mt-4">{{ displayText }}</span>
  </div>

  <div *ngIf="error" class="text-red-500 text-center">{{ error }}</div>
  <div *ngIf="!loading && !error && photos.length === 0 && allLoaded" class="text-gray-500 text-center py-12">
    <p class="text-xl sm:text-2xl lg:text-3xl font-bold">Aucune photo trouvÃ©e pour ce jour.</p>
  </div>
  
  <div class="flex justify-center">
    <ngx-masonry 
      class="w-full"
      *ngIf="allLoaded && !error && photos.length > 0" 
      [options]="{ gutter: 16, percentPosition: true }">
      <div ngxMasonryItem *ngFor="let photo of photos" 
           class="w-full sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/5 mb-4 px-2 transition-all duration-400 ease-in-out">
        <div class="block rounded-xl overflow-hidden shadow-lg transform transition-transform duration-300 hover:scale-[1.03] hover:shadow-2xl cursor-pointer" 
             (click)="openModal(photo)">
          <img
            [src]="photo.thumbnailUrl"
            [alt]="photo.description"
            class="h-auto max-w-full rounded-xl block mx-auto"
            loading="lazy"
            decoding="async"
          />
          <div *ngIf="photo.description" class="p-3 text-center">
            <p class="text-xs text-gray-600 dark:text-gray-300">{{ photo.description }}</p>
          </div>
        </div>
      </div>
    </ngx-masonry>
  </div>
  
  <div style="display: none;">
    <img
      *ngFor="let photo of photos"
      [src]="photo.thumbnailUrl"
      (load)="onImageLoad()"
      (error)="onImageError()"
      [alt]="photo.description"
    />
  </div>

  <div *ngIf="showModal && selectedPhoto" 
       class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
       (click)="onOverlayClick($event)">
    <div class="relative max-w-[95vw] max-h-[90vh] flex flex-col bg-white bg-opacity-95 backdrop-blur-sm rounded-xl shadow-2xl">
      <button 
        (click)="closeModal()" 
        class="absolute top-4 right-4 text-gray-700 text-2xl hover:text-gray-500 z-10 bg-white bg-opacity-80 rounded-full w-10 h-10 flex items-center justify-center shadow-lg">
        Ã—
      </button>
      
      <div class="flex flex-col lg:flex-row max-h-[85vh] overflow-hidden">
        
        <div class="flex flex-col lg:w-2/3 lg:border-r lg:border-gray-200">
          <div class="flex-shrink-0 p-6 pb-4 flex justify-center items-center">
            <img 
              [src]="selectedPhoto.url" 
              [alt]="selectedPhoto.description"
              class="max-w-full max-h-[50vh] lg:max-h-[70vh] object-contain rounded-lg"
            />
          </div>
          
          <div *ngIf="selectedPhoto.description" class="px-6 pb-4 lg:pb-6">
            <p class="text-gray-800 text-center font-medium">{{ selectedPhoto.description }}</p>
          </div>
        </div>
        
        <app-comments [photoId]="selectedPhoto.id" class="lg:w-1/3 h-full"></app-comments>
      </div>
    </div>
  </div>
</div>

<ng-template #noPhotos>
  <div class="flex flex-col items-center justify-center h-[calc(100vh-200px)] text-center px-4">
    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-gray-900 dark:text-white mb-6 animate-pulse">Veuillez patienter</h1>
    <div class="w-64 h-64 sm:w-80 sm:h-80 md:w-96 md:h-96 flex items-center justify-center">
      <ng-lottie [options]="loaderOptions" class="w-full h-full"></ng-lottie>
    </div>
    <span class="text-lg sm:text-xl font-medium text-gray-500 dark:text-gray-400 mt-4 max-w-lg">
      {{ displayText }}
    </span>
  </div>
</ng-template>