
<app-breadcrumb></app-breadcrumb>

  <div *ngIf="photos.length > 0; else noPhotos">
    <h1 class="text-3xl font-bold mb-6 text-gray-700 text-center">Photos du jour</h1>
    

    <!-- Loader affiché pendant le chargement
    <div *ngIf="!allLoaded" class="flex flex-col items-center justify-center min-h-[300px]">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-solid mb-4"></div>
      <div class="text-gray-500">Chargement des photos...</div>
    </div> -->


    <!-- Préchargement invisible des images -->
    <div style="display: none;">
      <img
        *ngFor="let photo of photos"
        [src]="photo.thumbnailUrl"
        (load)="onImageLoad()"
        (error)="onImageError()"
        [alt]="photo.description"
      />
    </div>

    <!-- Messages d'erreur et états -->
    <div *ngIf="error" class="text-red-500">{{ error }}</div>
    <div *ngIf="!loading && !error && photos.length === 0 && allLoaded" class="text-gray-500">
      Aucune photo trouvée pour ce jour.
    </div>

    <!-- Grille affichée après préchargement complet -->
    <div class="ml-30">
    <ngx-masonry class="ml-auto mr-auto"
      *ngIf="allLoaded && !error && photos.length > 0" 
      [options]="{ gutter: 16, percentPosition: true }">
      <div ngxMasonryItem *ngFor="let photo of photos" class="masonry-item w-[300px] mb-4 transition-[top,left] duration-[400ms] ease-in-out ml-4">
        <img
          [src]="photo.thumbnailUrl"
          class="w-full block mb-2 rounded-2xl cursor-pointer hover:opacity-90 transition-opacity"
          loading="lazy"
          decoding="async"
          (click)="openModal(photo)"
        />
        <div>
          <small>{{ photo.description }}</small>
        </div>
      </div>
    </ngx-masonry>
  </div>

    <!-- Modal pour afficher la photo en grand -->
    <div 
      *ngIf="showModal && selectedPhoto" 
      class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
      (click)="onOverlayClick($event)"
    >
      <div class="relative max-w-[95vw] max-h-[90vh] flex flex-col bg-white bg-opacity-95 backdrop-blur-sm rounded-xl shadow-2xl">
        <!-- Bouton de fermeture -->
        <button 
          (click)="closeModal()" 
          class="absolute top-4 right-4 text-gray-700 text-2xl hover:text-gray-500 z-10 bg-white bg-opacity-80 rounded-full w-10 h-10 flex items-center justify-center shadow-lg"
        >
          ×
        </button>
        
        <!-- Container principal responsive -->
        <div class="flex flex-col lg:flex-row max-h-[85vh] overflow-hidden">
          
          <!-- Section Image et Description (gauche sur desktop, haut sur mobile) -->
          <div class="flex flex-col lg:w-2/3 lg:border-r lg:border-gray-200">
            <!-- Image en grand -->
            <div class="flex-shrink-0 p-6 pb-4 flex justify-center items-center">
              <img 
                [src]="selectedPhoto.url" 
                [alt]="selectedPhoto.description"
                class="max-w-full max-h-[50vh] lg:max-h-[70vh] object-contain rounded-lg"
              />
            </div>
            
            <!-- Description -->
            <div *ngIf="selectedPhoto.description" class="px-6 pb-4 lg:pb-6">
              <p class="text-gray-800 text-center font-medium">{{ selectedPhoto.description }}</p>
            </div>
          </div>
          
          <!-- Section Commentaires (droite sur desktop, bas sur mobile) -->
          <app-comments [photoId]="selectedPhoto.id" class="lg:w-1/3 h-full"></app-comments>
        </div>
      </div>
    </div>
  </div>

     <ng-template #noPhotos>
      <h1 class=" text-center mb-4 text-4xl  leading-none tracking-tight text-gray-900 md:text-5xl lg:text-6xl dark:text-white">Veuillez patienter</h1>
    <div class="flex flex-col items-center justify-center mt-8">
      <div class="w-64 h-64 sm:w-96 sm:h-96 md:w-[32rem] md:h-[32rem] lg:w-[560px] lg:h-[560px] flex items-center justify-center">
        <ng-lottie [options]="loaderOptions" class="w-full h-full"></ng-lottie>
      </div>
      <span class="text-2xl sm:text-3xl font-bold text-gray-700 mt-2 text-center block">
        {{ displayText }}
      </span>
    </div>
  </ng-template>
