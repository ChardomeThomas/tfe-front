
<div class="container">
  <!-- Formulaire d'ajout -->
  <mat-card class="section-card">
    <mat-card-title>Ajouter un voyage</mat-card-title>
    <form [formGroup]="voyageForm" (ngSubmit)="addVoyage()" class="form-container">
      <div class="form-fields">
        <mat-form-field appearance="fill">
          <mat-label>Titre du voyage</mat-label>
          <input matInput formControlName="title" />
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Date de début</mat-label>
          <input matInput [matDatepicker]="startPicker" formControlName="startDate" />
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
          <mat-error *ngIf="voyageForm.get('startDate')?.hasError('afterEndDate')">
            La date de début ne peut pas être après la date de fin.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Date de fin</mat-label>
          <input matInput [matDatepicker]="endPicker" formControlName="endDate" />
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
          <mat-error *ngIf="voyageForm.get('endDate')?.hasError('beforeStartDate')">
            La date de fin ne peut pas être avant la date de début.
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-actions">
        <button mat-raised-button color="primary" type="submit" [disabled]="voyageForm.invalid">
          Ajouter
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Voyages actifs -->
  <app-item-table
    title="Voyages actifs"
    [dataSource]="voyages"
    [columns]="['title', 'dates']"
    [actionsTemplate]="activeVoyageActions"
  ></app-item-table>

  <ng-template #activeVoyageActions let-voyage>
    <button
      mat-icon-button
      [routerLink]="['/admin','countries',countryId,'voyages',voyage.id,'jours']"
      matTooltip="Voir les jours"
    >
      <mat-icon>navigate_next</mat-icon>
    </button>
    <button
      mat-button
      color="accent"
      (click)="unpublish(voyage)"
    >
      Dépublier
    </button>
    <button mat-icon-button color="warn" (click)="delete(voyage)">
      <mat-icon>delete</mat-icon>
    </button>
  </ng-template>

  <!-- Voyages non publiés -->
  <app-item-table
    title="Voyages non publiés"
    [dataSource]="unpublishedVoyages"
    [columns]="['title', 'dates']"
    [actionsTemplate]="unpublishedVoyageActions"
  ></app-item-table>

  <ng-template #unpublishedVoyageActions let-voyage>
    <button
      mat-icon-button
      [routerLink]="['/admin','countries',countryId,'voyages',voyage.id,'jours']"
      matTooltip="Voir les jours"
    >
      <mat-icon>navigate_next</mat-icon>
    </button>
    <button
      mat-button
      color="primary"
      (click)="publish(voyage)"
    >
      Publier
    </button>
    <button mat-icon-button color="warn" (click)="delete(voyage)">
      <mat-icon>delete</mat-icon>
    </button>
  </ng-template>

  <!-- Voyages supprimés -->
  <app-item-table
    title="Voyages supprimés"
    [dataSource]="deletedVoyages"
    [columns]="['title', 'dates']"
    [actionsTemplate]="deletedVoyageActions"
  ></app-item-table>

  <ng-template #deletedVoyageActions let-voyage>
    <button
      mat-icon-button
      [routerLink]="['/admin','countries',countryId,'voyages',voyage.id,'jours']"
      matTooltip="Voir les jours"
    >
      <mat-icon>navigate_next</mat-icon>
    </button>
    <button mat-button color="primary" (click)="restore(voyage)">
      Restaurer
    </button>
  </ng-template>
</div>
